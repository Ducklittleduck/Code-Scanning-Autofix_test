name: Build and Analyze C Project

on:
  push:
    branches: [main]  # 当推送到 main 分支时触发
  pull_request:
    branches: [main]  # 当向 main 分支提交 PR 时触发

jobs:
  build:
    name: Build the C project
    runs-on: ubuntu-latest  # 使用最新版本的 Ubuntu 运行这个 job

    steps:
      # 步骤 1: 检出代码
      - name: Checkout code
        uses: actions/checkout@v2  # 这个步骤将代码从 GitHub 仓库中检出到 GitHub Actions 环境

      # 步骤 2: 安装构建工具和依赖
      - name: Install build dependencies
        run: |
          sudo apt-get update  # 更新软件包列表
          sudo apt-get install -y build-essential  # 安装构建工具，如 gcc 编译器和 make

      # 步骤 3: 构建项目
      - name: Build the project with Make
        run: |
          make clean  # 清理旧的构建文件
          make        # 使用 make 构建项目

      # 步骤 4: 设置 CodeQL 工具进行代码分析
      - name: Set up CodeQL
        uses: github/codeql-action/init@v2  # 配置 CodeQL 执行静态代码分析

      # 步骤 5: 执行代码分析
      - name: Analyze code with CodeQL
        uses: github/codeql-action/analyze@v2  # 执行 CodeQL 分析代码，检查安全问题等
